---
layout: layout.njk
eleventyExcludeFromCollections: true
---

<div class="home">
  <section class="intro">
    <p>
      üëãüèæ I'm a software engineer working on <a href="https://turborepo.org">Turborepo</a> at
      <a href="https://vercel.com"><span class="vercel-icon">‚ñ≤</span>Vercel</a>.
      Before that, I worked at Apple</a>.
      <span class="mobile-only">See what I've been up to <a href="#recent">recently</a>.</span>
      <a href="/resume">Resume</a>.
    </p>
  </section>

  <aside>
    <h3 id="recent">Recently</h3>
    <ul class="small">
      <li>
        {# TODO: Make this dynamic #}
        üìö Read <a target="_blank" rel="noopener noreferrer" href="https://www.goodreads.com/review/show/4794773798"><em>Vanderbilt: The Rise and Fall of an American Dynasty</em>.</a>

      <li>
        <p id="film-preamble">
          üé¨ Watched <span id="movie">...</span> <time>...</time> and rated it <span id="rating">0/5</span>.
        </p>
      </li>

      <li>
        <p id="tweet-preamble">‚ù§Ô∏è Liked a tweet:</p>
        <figure id="tweet">
          <div>
            <img id="tweet-author-picture" class="tweet-author-picture tweet-author-picture--initial" src="" width="30" height="30" role="presentation">
            <blockquote cite=""></blockquote>
          </div>

          <figcaption class="flex items-center mr1">
            {# https://feathericons.com/?query=twitter #}
            <svg
              xmlns="http://www.w3.org/2000/svg"
              width="12"
              height="12"
              class="mr1"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
              stroke-linecap="round"
              stroke-linejoin="round">
              <path d="M23 3a10.9 10.9 0 0 1-3.14 1.53 4.48 4.48 0 0 0-7.86 3v1A10.66 10.66 0 0 1
              3 4s-4 9 5 13a11.64 11.64 0 0 1-7 2c9 5 20 0 20-11.5a4.5 4.5 0 0 0-.08-.83A7.72 7.72 0 0 0 23 3z"></path>
            </svg>
            <cite></cite>
          </figcaption>
        </figure>
      </li>

      <li>
        <p id="feedly-preamble">üñäÔ∏è Highlighted <time>...</time> via Feedly RSS reader:</p>
        <figure id="feedly-annotation">
          <blockquote cite=""></blockquote>

          <figcaption class="flex items-center">
            {# https://feathericons.com/?query=rss #}
            <svg
              xmlns="http://www.w3.org/2000/svg"
              width="14"
              height="14"
              class="mr1"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
              stroke-linecap="round"
              stroke-linejoin="round">
              <title>Link to RSS feed</title>
              <path d="M4 11a9 9 0 0 1 9 9"></path>
              <path d="M4 4a16 16 0 0 1 16 16"></path>
              <circle cx="5" cy="19" r="1"></circle>
            </svg>
            <cite></cite>
          </figcaption>
        </figure>
      </li>
    </ul>
  </aside>

  <section class="posts">
    <h2 class="mb3">Posts</h2>
    {% set posts = collections.byYear | category(["programming", "indieweb", "web"]) %}
    {% from 'partials/_by-year.njk' import render %}
    {{ render(posts) }}
  </section>
</div>

<script>
  fetch("/api/recent").then(res => res.json()).then(({ film, tweet, annotation }) => {
    setFilmHTML(film);
    setTweetHTML(tweet);
    setAnnotationHTML(annotation);
  });

  function setFilmHTML(data) {
    console.log('film', data);
    const { name, rating, timestamp, url } = data;
    document.getElementById('movie').innerHTML = `<a href="${url}">${name}</a>`;

    // time element
    setTimeElement(document.querySelector('#film-preamble time'), timestamp);

    document.getElementById('rating').innerText = `${rating}/5 stars`;
  }

  function setTweetHTML(data) {
    console.log('tweet', data);
    const { tweet, author } = data;
    const url = `https://twitter.com/${author.username}/status/${tweet.id}`;
    const authorUrl = `https://twitter.com/${author.username}`;

    const tweetElement = document.getElementById('tweet');

    tweetElement.querySelector('blockquote').setAttribute('cite', url);
    tweetElement.querySelector('blockquote').innerHTML = tweet.html;
    tweetElement.querySelector('cite').innerHTML = `<a target="_blank" rel="noopener noreferrer" href="${url}">‚Äî @${author.username}</a>`;
    const imgEl = tweetElement.querySelector('#tweet-author-picture')
    imgEl.setAttribute('src', author.profile_image_url);
    imgEl.classList.remove('tweet-author-picture--initial')
  }

  function setAnnotationHTML(data) {
    console.log('annotation', data)
    const { text, originTitle, originURL, timestamp } = data;
    const element = document.getElementById('feedly-annotation');

    element.querySelector('blockquote').innerHTML = `<p>${text}</p>`;

    // time element
    setTimeElement(document.querySelector('#feedly-preamble time'), timestamp);

    if (originTitle &&  originURL) {
      element.querySelector('blockquote').setAttribute('cite', originURL);
      element.querySelector('cite').innerHTML = `<a target="_blank" rel="noopener noreferrer" href="${originURL}">‚Äî ${originTitle}</a>`;
    }
  }

  function setTimeElement(el, ts) {
    el.setAttribute('datetime', ts);
    el.innerText = daysAgo(ts);
  }

  function daysAgo(timestamp) {
    const daysAgo = Math.round((new Date() - new Date(timestamp)) / 1000 / 60 / 60 / 24);
    return new Intl.RelativeTimeFormat('en', { numeric: 'auto' }).format(daysAgo * -1, 'days')
  }
</script>
